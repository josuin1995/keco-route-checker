<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>폐기물처분부담금 사전계산 · 재활용 안내</title>
<style>
  :root { --gap: 10px; --radius: 12px; --muted:#6b7280; --shadow: 0 10px 20px rgba(0,0,0,.08); }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif; margin: 0; padding: 20px; background:#f8fafc; color:#111; }
  .wrap { max-width: 1040px; margin:0 auto; }
  h1 { margin:0 0 10px 0; font-size:22px; }
  .card { background:#fff; border:1px solid #e5e7eb; border-radius: var(--radius); padding:14px; box-shadow: var(--shadow); margin-bottom:12px; }
  .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
  label { display:block; font-weight:600; margin-top:10px; }
  input, select { padding:8px 10px; border:1px solid #d1d5db; border-radius:8px; width:100%; box-sizing:border-box; }
  .grid { display:grid; gap:12px; }
  .grid-2 { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
  .grid-3 { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
  .muted { color: var(--muted); font-size:12px; }
  .note { font-size:12px; color:#475569; }
  .result { font-size:20px; font-weight:800; }
  .tag { display:inline-block; padding:4px 8px; border-radius:999px; background:#f1f5f9; border:1px solid #e2e8f0; font-size:12px; margin-right:6px; }
  .btn { padding:10px 14px; border-radius:10px; border:1px solid #e5e7eb; background:#111; color:#fff; cursor:pointer; }
  .btn:active { transform: translateY(1px); }
  .btn-wide { display:flex; align-items:center; gap:10px; width:100%; padding:12px 16px; border-radius:12px;
    background: linear-gradient(135deg, #3b82f6, #7c3aed); color:#fff; font-weight:800; text-decoration:none;
    box-shadow: 0 10px 20px rgba(99,102,241,.28); border:0; justify-content:center; }
  .btn-wide:hover { filter: brightness(0.98); }
  .btn-wide .ico { font-size:14px; opacity:.95; }
  .section-title { display:flex; align-items:center; gap:8px; font-size:18px; font-weight:800; margin:0 0 8px 0; }
  .hl { background: linear-gradient(transparent 70%, #e0f7f1 0); border-radius:6px; padding:0 2px; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>폐기물처분부담금 사전계산 · 재활용 안내 <span class="muted">(IPCC·IO·ETS 반영)</span></h1>

    <!-- A. 기본 조건 -->
    <div class="card">
      <div class="section-title">A. 기본 조건</div>
      <div class="grid grid-2">
        <div>
          <label for="wasteType">폐기물 유형</label>
          <select id="wasteType">
            <option value="사업장폐기물">사업장폐기물</option>
            <option value="건설폐기물">건설폐기물</option>
          </select>
        </div>
        <div id="wasteCharWrap">
          <label for="wasteChar">폐기물 특성 <span class="muted">(사업장폐기물만 해당)</span></label>
          <select id="wasteChar">
            <option value="가연성">가연성</option>
            <option value="불연성">불연성</option>
          </select>
        </div>
        <div>
          <label for="treatment">처리 방식</label>
          <select id="treatment">
            <option value="소각">소각</option>
            <option value="매립">매립</option>
          </select>
        </div>
        <div>
          <label for="disposalYear">처분년도</label>
          <select id="disposalYear"></select>
        </div>
      </div>
      <div class="note" style="margin-top:8px;">
        ※ 본 버전의 온실가스 절감량은 <span class="hl">동아시아 MSW 평균조성 가중 배출계수(0.207451 kgCO₂/kg)</span>를 기본값으로 사용합니다.
        처리방식·세부 인자(회수율 등)별 상세 계수는 다음 업데이트에 반영 예정입니다.
      </div>
    </div>

    <!-- B. 비용·지표 입력 -->
    <div class="card">
      <div class="section-title">B. 비용·지표 입력</div>
      <div class="grid grid-3">
        <div>
          <label for="wasteAmount">배출량(kg)</label>
          <input id="wasteAmount" type="number" min="0" step="1" placeholder="예: 1000">
        </div>
        <div>
          <label for="unitCostKRW">처리/재활용 단가 (원/톤) <span class="muted">(기본 150,000)</span></label>
          <input id="unitCostKRW" type="number" min="0" step="1000" placeholder="예: 150000">
        </div>
        <div>
          <label for="empCoef">고용유발계수 (명/10억 원) <span class="muted">(기본 10)</span></label>
          <input id="empCoef" type="number" min="0" step="0.01" placeholder="업종별 값 입력">
        </div>
        <div>
          <label for="etsPrice">ETS 기준가 (원/tCO₂) <span class="muted">(기본 90,000)</span></label>
          <input id="etsPrice" type="number" min="0" step="1" placeholder="예: 90000">
        </div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button id="calcBtn" type="button" class="btn">계산하기</button>
        <span class="muted">배출량만 입력해도 자동 계산됩니다.</span>
      </div>
    </div>

    <!-- C. 결과 -->
    <div class="card">
      <div class="section-title">C. 결과</div>
      <div id="selSummary" style="margin-bottom:8px;">
        <span class="tag" id="tagType">유형: -</span>
        <span class="tag" id="tagChar">특성: -</span>
        <span class="tag" id="tagTreat">처리: -</span>
        <span class="tag" id="tagYear">년도: -</span>
      </div>
      <div class="row">
        <div>🌍 <strong>온실가스 절감:</strong> <span id="outGHG" class="result">-</span> <span class="muted">kg CO₂</span> <span class="muted">(IPCC 공식 EF)</span></div>
      </div>
      <div class="row">
        <div>👷 <strong>일자리 창출:</strong> <span id="outJOB" class="result">-</span> <span class="muted">명</span> <span class="muted">(IO 고용유발계수)</span></div>
      </div>
      <div class="row">
        <div>🌱 <strong>환경보전 가치:</strong> <span id="outVAL" class="result">-</span> <span class="muted">원</span> <span class="muted">(K-ETS 기준가)</span></div>
      </div>
      <div class="muted" style="margin-top:8px; line-height:1.6;">
        • EF(동아시아 MSW 평균조성 가중) = <span class="hl">0.207451 kgCO₂/kg</span> (= 0.207451 tCO₂/톤·습).<br>
        • 의미: 폐기물 세부조성(플라스틱, 종이 등)의 배출계수를 동아시아 평균 조성비로 가중평균한 단일 EF입니다. 사용자는 조성 입력 없이 평균값으로 빠르게 추정할 수 있습니다.
      </div>
    </div>

    <!-- D. 순환자원정보센터 안내 + 두 버튼 -->
    <div class="card" id="recenterServices">
      <div class="section-title"><span>♻️</span><span>재활용 전환을 위한 순환정보센터 안내</span></div>
      <div class="row" style="flex-direction:column; align-items:stretch; gap:10px;">
        <a class="btn-wide" href="https://www.re.or.kr/circul/listPubCirculSup.do" target="_blank" rel="noopener">
          <span class="ico">▶</span><span>유통지원 신청 바로가기</span>
        </a>
        <a class="btn-wide" href="https://www.re.or.kr/info/listTrtmPage.do" target="_blank" rel="noopener">
          <span class="ico">▶</span><span>재활용 처리업체 찾기</span>
        </a>
      </div>
    </div>
  </div>

<script>
// --- 상수/저장키
const EF_MSW_EA_KGKG = 0.2074510533; // kgCO2/kg (동아시아 MSW 평균조성 가중 EF)
const LSKEY='levy_io_ets_defaults_v4';

// --- Dom helpers
const $ = (id)=> document.getElementById(id);
const num = (id)=> { const v=parseFloat(($(id)?.value)||''); return isFinite(v) ? v : 0; };

// --- 기본년도 셀렉트 바인딩
function fillYears(){
  const now = new Date().getFullYear();
  const s = $('disposalYear'); if(!s) return;
  s.innerHTML = '';
  for(let y = now+1; y >= 2018; y--){
    const op = document.createElement('option'); op.value = y; op.textContent = y + '년';
    s.appendChild(op);
  }
  s.value = String(now);
}

// --- 기본값 로드/저장
function loadDefaults(){
  try{
    const saved = JSON.parse(localStorage.getItem(LSKEY) || '{}');
    const defs = Object.assign({
      wasteType:'사업장폐기물',
      wasteChar:'가연성',
      treatment:'소각',
      disposalYear:String(new Date().getFullYear()),
      unitCostKRW:150000,
      empCoef:10,
      etsPrice:90000
    }, saved);
    ['wasteType','wasteChar','treatment','disposalYear','unitCostKRW','empCoef','etsPrice'].forEach(id=>{
      if($(id)){ $(id).value = defs[id]; }
    });
    if(saved.wasteAmount){ $('wasteAmount').value = saved.wasteAmount; }
  }catch(e){}
  toggleWasteChar();
  updateTags();
}
function saveDefaults(){
  try{
    const vals={};
    ['wasteType','wasteChar','treatment','disposalYear','unitCostKRW','empCoef','etsPrice'].forEach(id=> vals[id]=($(id)?.value)||'');
    vals.wasteAmount = num('wasteAmount');
    localStorage.setItem(LSKEY, JSON.stringify(vals));
  }catch(e){}
}

// --- UI helpers
function toggleWasteChar(){
  const wrap = $('wasteCharWrap');
  const show = ($('wasteType').value === '사업장폐기물');
  wrap.style.display = show ? 'block' : 'none';
}
function updateTags(){
  $('tagType').textContent = '유형: ' + ($('wasteType').value || '-');
  $('tagChar').style.display = ($('wasteType').value==='사업장폐기물') ? 'inline-block' : 'none';
  $('tagChar').textContent = '특성: ' + ($('wasteChar').value || '-');
  $('tagTreat').textContent = '처리: ' + ($('treatment').value || '-');
  $('tagYear').textContent = '년도: ' + ($('disposalYear').value || '-');
}

// --- 계산
function calculate(){
  // 현재 버전: 처리방식·특성 등은 표시/저장만 하고 EF는 동일(차등 EF는 차기 반영)
  const kg = num('wasteAmount');
  const carbonReduction = Math.round(kg * EF_MSW_EA_KGKG * 1000) / 1000; // kg CO2
  const etsPrice = num('etsPrice'); // 원/tCO2
  const recycleValue = (etsPrice>0) ? (carbonReduction/1000) * etsPrice : 0; // KRW
  const unitCost = num('unitCostKRW'); // 원/톤
  const empCoef = num('empCoef'); // 명/10억
  const expenditure = (kg/1000) * unitCost; // KRW
  const jobCreation = (expenditure/1_000_000_000) * empCoef; // 명

  $('outGHG').textContent = isFinite(carbonReduction) ? carbonReduction.toLocaleString() : '-';
  $('outJOB').textContent = isFinite(jobCreation) ? jobCreation.toFixed(3) : '-';
  $('outVAL').textContent = isFinite(recycleValue) ? Math.round(recycleValue).toLocaleString() : '-';
}

// --- 이벤트 바인딩
document.addEventListener('DOMContentLoaded', function(){
  fillYears();
  loadDefaults();
  ['wasteType','wasteChar','treatment','disposalYear','wasteAmount','unitCostKRW','empCoef','etsPrice'].forEach(id=>{
    const el=$(id); if(!el) return;
    ['input','change'].forEach(evt=> el.addEventListener(evt, ()=>{ toggleWasteChar(); updateTags(); saveDefaults(); calculate(); }));
  });
  const btn = $('calcBtn');
  if(btn){ btn.type='button'; btn.addEventListener('click', (e)=>{ e.preventDefault(); calculate(); }); }
  // 초기 계산
  calculate();
});
</script>
</body>
</html>
