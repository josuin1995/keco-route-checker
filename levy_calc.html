<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>íê¸°ë¬¼ì²˜ë¶„ë¶€ë‹´ê¸ˆ ê³„ì‚° ë° ì¬í™œìš© ì•ˆë‚´</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h60h6qbl1u&submodules=geocoder"></script>
  <style>
    #map {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-green-700 text-white p-4 text-center">
    <h1 class="text-xl font-bold mt-2">íê¸°ë¬¼ì²˜ë¶„ë¶€ë‹´ê¸ˆ ì‚¬ì „ ê³„ì‚° ë° ì¬í™œìš© ì•ˆë‚´</h1>
  </header>

  <main class="max-w-2xl mx-auto p-4 bg-white shadow-lg rounded-lg mt-6 space-y-6">
    <!-- íê¸°ë¬¼ ì •ë³´ ì…ë ¥ -->
    <section>
      <label class="block font-semibold">íê¸°ë¬¼ ìœ í˜•</label>
      <select id="wasteCategory" onchange="updateOptions()" class="w-full border rounded px-3 py-2">
        <option value="business">ì‚¬ì—…ì¥íê¸°ë¬¼</option>
        <option value="construction">ê±´ì„¤íê¸°ë¬¼</option>
      </select>

      <label class="block font-semibold mt-4">ì²˜ë¦¬ ë°©ì‹</label>
      <select id="disposalMethod" class="w-full border rounded px-3 py-2">
        <option value="incineration">ì†Œê°</option>
        <option value="landfill">ë§¤ë¦½</option>
      </select>

      <div id="wasteTypeContainer">
        <label class="block font-semibold mt-4">íê¸°ë¬¼ íŠ¹ì„± (ì‚¬ì—…ì¥íê¸°ë¬¼ë§Œ í•´ë‹¹)</label>
        <select id="wasteType" class="w-full border rounded px-3 py-2">
          <option value="combustible">ê°€ì—°ì„±</option>
          <option value="non_combustible">ë¶ˆì—°ì„±</option>
        </select>
      </div>

      <label class="block font-semibold mt-4">ì²˜ë¶„ë…„ë„</label>
      <select id="disposalYear" class="w-full border rounded px-3 py-2">
        <option value="2018">2018</option>
        <option value="2019">2019</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
        <option value="2023">2023</option>
        <option value="2024" selected>2024</option>
        <option value="2025">2025</option>
      </select>

      <label class="block font-semibold mt-4">ë°°ì¶œëŸ‰ (kg)</label>
      <input type="number" id="wasteAmount" class="w-full border rounded px-3 py-2" placeholder="ì˜ˆ: 100" />
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
        <div>
          <label class="block font-semibold">ì²˜ë¦¬/ì¬í™œìš© ë‹¨ê°€ (ì›/í†¤)</label>
          <input id="unitCostKRW" type="number" min="0" step="1000" class="w-full border rounded px-3 py-2" placeholder="ì˜ˆ: 150000">
          <div class="text-gray-500 text-sm mt-1">ì¼ìë¦¬ ê³„ì‚°: ì§€ì¶œì•¡ = í†¤ìˆ˜ Ã— ë‹¨ê°€</div>
        </div>
        <div>
          <label class="block font-semibold">ê³ ìš©ìœ ë°œê³„ìˆ˜ (ëª…/10ì–µ ì›)</label>
          <input id="empCoef" type="number" min="0" step="0.01" class="w-full border rounded px-3 py-2" placeholder="ì—…ì¢…ë³„ ê°’ ì…ë ¥">
          <div class="text-gray-500 text-sm mt-1">ê·¼ê±°: í•œêµ­ì€í–‰ ì‚°ì—…ì—°ê´€í‘œ(ê³ ìš©í‘œ/ìœ ë°œê³„ìˆ˜)</div>
        </div>
        <div>
          <label class="block font-semibold">ETS ê¸°ì¤€ê°€ (ì›/tCOâ‚‚)</label>
          <input id="etsPrice" type="number" min="0" step="1" class="w-full border rounded px-3 py-2" placeholder="ì˜ˆ: 90000">
          <div class="text-gray-500 text-sm mt-1">K-ETS ì‹œì„¸(ìˆ˜ë™ ì…ë ¥)</div>
        </div>
      </div>

      

      <button onclick="calculate()" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-2 rounded font-semibold">
        ë¹„ìš© ê³„ì‚°
      </button>
    </section>

    <!-- ê²°ê³¼ ì¶œë ¥ -->
    <section>
      <div id="result" class="p-4 bg-gray-50 border rounded text-sm"></div>
      <div class="mt-6">
        <canvas id="costChart"></canvas>
      </div>
    </section>

    <!-- ìˆœí™˜ìì›ì •ë³´ì„¼í„° ë§í¬ -->
    <section class="mt-6 space-y-2">
      <h2 class="text-lg font-bold">â™»ï¸ ìˆœí™˜ìì›ì •ë³´ì„¼í„° ì„œë¹„ìŠ¤</h2>
      <a href="https://www.re.or.kr/circul/listPubCirculSup.do" target="_blank" class="block bg-blue-600 hover:bg-blue-700 text-white text-center py-2 px-4 rounded">
        â–¶ ìœ í†µì§€ì› ì‹ ì²­ ë°”ë¡œê°€ê¸°
      </a>
      <a href="https://www.re.or.kr/info/listTrtmPage.do" target="_blank" class="block bg-indigo-600 hover:bg-indigo-700 text-white text-center py-2 px-4 rounded">
        â–¶ ì¬í™œìš© ì²˜ë¦¬ì—…ì²´ ì°¾ê¸°
      </a>
    </section>

    <!-- ì§€ë„ ê²€ìƒ‰ -->
    <section class="mt-10">
      <h2 class="text-lg font-bold mb-2">ğŸ“ ì§€ì—­ ê¸°ë°˜ ì¬í™œìš© ì²˜ë¦¬ì—…ì²´ ìœ„ì¹˜ ë³´ê¸°</h2>
      <label for="regionInput" class="block font-semibold mb-1">ì§€ì—­ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê´‘ì£¼ ì¬í™œìš©)</label>
      <div class="flex gap-2">
        <input type="text" id="regionInput" placeholder="ì˜ˆ: ê´‘ì£¼ ì¬í™œìš©" class="flex-1 border rounded px-3 py-2" />
        <button onclick="searchRegion()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">ì§€ë„ì— í‘œì‹œ</button>
      </div>
      <div id="map" class="mt-4"></div>
    </section>
  </main>

  <script>
    let chart;
    // IPCC 2006 GL Vol.5 Ch.2 Table 2.4 + 2019 Refinement Vol.5 (Eastern Asia mix)
const EF_MSW_EA_KGKG = 0.2074510533; // kgCO2/kg (0.20745 tCO2/t-wet)

const rateIndex = {
      2018: 1, 2019: 1.019, 2020: 1.023, 2021: 1.024,
      2022: 1.059, 2023: 1.132, 2024: 1.168, 2025: 1.192
    };

    function updateOptions() {
      const category = document.getElementById("wasteCategory").value;
      const wasteTypeContainer = document.getElementById("wasteTypeContainer");
      wasteTypeContainer.style.display = category === "business" ? "block" : "none";
    }

    function getNum(id) { var el = document.getElementById(id); return el ? (parseFloat(el.value)||0) : 0; }
function calculate() {
      const category = document.getElementById("wasteCategory").value;
      const disposalMethod = document.getElementById("disposalMethod").value;
      const wasteType = document.getElementById("wasteType").value;
      const disposalYear = document.getElementById("disposalYear").value;
      const wasteAmount = parseFloat(document.getElementById("wasteAmount").value);

      if (isNaN(wasteAmount) || wasteAmount <= 0) {
        alert("ìœ íš¨í•œ ë°°ì¶œëŸ‰(kg)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const index = rateIndex[disposalYear];
      let rate = 0;

      if (category === 'business') {
        if (disposalMethod === 'incineration') rate = 10;
        else if (disposalMethod === 'landfill') rate = (wasteType === 'combustible') ? 25 : 10;
      } else if (category === 'construction') {
        rate = (disposalMethod === 'incineration') ? 10 : 30;
      }

      const fee = wasteAmount * rate * index;
      const etsPrice = getNum('etsPrice');
      const recycleValue = (etsPrice>0) ? (carbonReduction/1000) * etsPrice : 0;
      const carbonReduction = Math.round(wasteAmount * EF_MSW_EA_KGKG * 1000) / 1000; // ê³µì‹ ë°°ì¶œê³„ìˆ˜ ê¸°ë°˜ (kgCOâ‚‚)
      const unitCost = getNum('unitCostKRW');
      const empCoef = getNum('empCoef');
      const expenditure = (wasteAmount/1000) * unitCost; // ì›
      const jobCreation = (expenditure/1_000_000_000) * empCoef;

      document.getElementById("result").innerHTML =
        `<strong>íê¸°ë¬¼ì²˜ë¶„ë¶€ë‹´ê¸ˆ:</strong> ${Math.round(fee).toLocaleString()}ì›<br>` +
        `<strong>ğŸŒ ì˜¨ì‹¤ê°€ìŠ¤ ì ˆê°:</strong> ${carbonReduction.toLocaleString()}kg COâ‚‚ <span class='text-gray-500'>(IPCC ê³µì‹ EF)</span><br>` +
        `<strong>ğŸ‘· ì¼ìë¦¬ ì°½ì¶œ:</strong> ${jobCreation.toFixed(3)} ëª… <span class='text-gray-500'>(IO ê³ ìš©ìœ ë°œê³„ìˆ˜)</span><br>` +
        `<strong>ğŸŒ± í™˜ê²½ë³´ì „ ê°€ì¹˜:</strong> ${recycleValue.toLocaleString()}ì› <span class='text-gray-500'>(K-ETS ê¸°ì¤€ê°€)</span>`;

      const ctx = document.getElementById("costChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["ì²˜ë¶„ë¶€ë‹´ê¸ˆ", "í™˜ê²½ë³´ì „ ê°€ì¹˜"],
          datasets: [{
            label: "ë¹„ìš©/í¸ìµ (ì›) â€” ETS/IO ë°˜ì˜",
            data: [fee, recycleValue],
            backgroundColor: ["#f87171", "#34d399"]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: context => `${context.dataset.label}: ${Math.round(context.raw).toLocaleString()}ì›`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: value => `${value.toLocaleString()}ì›`
              }
            }
          }
        }
      });
    }

    let map;
    let marker;
    let infoWindow;

    function initMap() {
      map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(37.5665, 126.9780),
        zoom: 12
      });
    }

    function searchRegion() {
      const keyword = document.getElementById('regionInput').value.trim();
      if (!keyword) {
        alert('ì§€ì—­ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ì˜ˆ: ê´‘ì£¼ ì¬í™œìš©');
        return;
      }

      naver.maps.Service.geocode({ query: keyword }, function(status, response) {
        if (status !== naver.maps.Service.Status.OK || !response.v2.addresses.length) {
          return alert('í•´ë‹¹ ì§€ì—­ì˜ ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }

        const item = response.v2.addresses[0];
        const position = new naver.maps.LatLng(item.y, item.x);

        map.setCenter(position);

        if (marker) marker.setMap(null);
        marker = new naver.maps.Marker({ map, position });

        if (infoWindow) infoWindow.close();
        infoWindow = new naver.maps.InfoWindow({
          content: `<div style="padding:5px;font-size:14px;">${keyword}</div>`
        });
        infoWindow.open(map, marker);
      });
    }

    window.onload = function () {
      updateOptions();
      initMap();
    };
  </script>
</body>
</html>