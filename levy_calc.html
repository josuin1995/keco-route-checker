<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>폐기물처분부담금 계산 및 재활용 안내</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=h60h6qbl1u&submodules=geocoder"></script>
  <style>
    #map {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-green-700 text-white p-4 text-center">
    <h1 class="text-xl font-bold mt-2">폐기물처분부담금 사전 계산 및 재활용 안내</h1>
  </header>

  <main class="max-w-2xl mx-auto p-4 bg-white shadow-lg rounded-lg mt-6 space-y-6">
    <!-- 폐기물 정보 입력 -->
    <section>
      <label class="block font-semibold">폐기물 유형</label>
      <select id="wasteCategory" onchange="updateOptions()" class="w-full border rounded px-3 py-2">
        <option value="business">사업장폐기물</option>
        <option value="construction">건설폐기물</option>
      </select>

      <label class="block font-semibold mt-4">처리 방식</label>
      <select id="disposalMethod" class="w-full border rounded px-3 py-2">
        <option value="incineration">소각</option>
        <option value="landfill">매립</option>
      </select>

      <div id="wasteTypeContainer">
        <label class="block font-semibold mt-4">폐기물 특성 (사업장폐기물만 해당)</label>
        <select id="wasteType" class="w-full border rounded px-3 py-2">
          <option value="combustible">가연성</option>
          <option value="non_combustible">불연성</option>
        </select>
      </div>

      <label class="block font-semibold mt-4">처분년도</label>
      <select id="disposalYear" class="w-full border rounded px-3 py-2">
        <option value="2018">2018</option>
        <option value="2019">2019</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
        <option value="2023">2023</option>
        <option value="2024" selected>2024</option>
        <option value="2025">2025</option>
      </select>

      <label class="block font-semibold mt-4">배출량 (kg)</label>
      <input type="number" id="wasteAmount" class="w-full border rounded px-3 py-2" placeholder="예: 100" />
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
        <div>
          <label class="block font-semibold">처리/재활용 단가 (원/톤)</label>
          <input id="unitCostKRW" type="number" min="0" step="1000" class="w-full border rounded px-3 py-2" placeholder="예: 150000">
          <div class="text-gray-500 text-sm mt-1">일자리 계산: 지출액 = 톤수 × 단가</div>
        </div>
        <div>
          <label class="block font-semibold">고용유발계수 (명/10억 원)</label>
          <input id="empCoef" type="number" min="0" step="0.01" class="w-full border rounded px-3 py-2" placeholder="업종별 값 입력">
          <div class="text-gray-500 text-sm mt-1">근거: 한국은행 산업연관표(고용표/유발계수)</div>
        </div>
        <div>
          <label class="block font-semibold">ETS 기준가 (원/tCO₂)</label>
          <input id="etsPrice" type="number" min="0" step="1" class="w-full border rounded px-3 py-2" placeholder="예: 90000">
          <div class="text-gray-500 text-sm mt-1">K-ETS 시세(수동 입력)</div>
        </div>
      </div>

      

      <button onclick="calculate()" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white py-2 rounded font-semibold">
        비용 계산
      </button>
    </section>

    <!-- 결과 출력 -->
    <section>
      <div id="result" class="p-4 bg-gray-50 border rounded text-sm"></div>
      <div class="mt-6">
        <canvas id="costChart"></canvas>
      </div>
    </section>

    <!-- 순환자원정보센터 링크 -->
    <section class="mt-6 space-y-2">
      <h2 class="text-lg font-bold">♻️ 순환자원정보센터 서비스</h2>
      <a href="https://www.re.or.kr/circul/listPubCirculSup.do" target="_blank" class="block bg-blue-600 hover:bg-blue-700 text-white text-center py-2 px-4 rounded">
        ▶ 유통지원 신청 바로가기
      </a>
      <a href="https://www.re.or.kr/info/listTrtmPage.do" target="_blank" class="block bg-indigo-600 hover:bg-indigo-700 text-white text-center py-2 px-4 rounded">
        ▶ 재활용 처리업체 찾기
      </a>
    </section>

    <!-- 지도 검색 -->
    <section class="mt-10">
      <h2 class="text-lg font-bold mb-2">📍 지역 기반 재활용 처리업체 위치 보기</h2>
      <label for="regionInput" class="block font-semibold mb-1">지역명을 입력하세요 (예: 광주 재활용)</label>
      <div class="flex gap-2">
        <input type="text" id="regionInput" placeholder="예: 광주 재활용" class="flex-1 border rounded px-3 py-2" />
        <button onclick="searchRegion()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">지도에 표시</button>
      </div>
      <div id="map" class="mt-4"></div>
    </section>
  </main>

  <script>
    let chart;
    // IPCC 2006 GL Vol.5 Ch.2 Table 2.4 + 2019 Refinement Vol.5 (Eastern Asia mix)
const EF_MSW_EA_KGKG = 0.2074510533; // kgCO2/kg (0.20745 tCO2/t-wet)

const rateIndex = {
      2018: 1, 2019: 1.019, 2020: 1.023, 2021: 1.024,
      2022: 1.059, 2023: 1.132, 2024: 1.168, 2025: 1.192
    };

    function updateOptions() {
      const category = document.getElementById("wasteCategory").value;
      const wasteTypeContainer = document.getElementById("wasteTypeContainer");
      wasteTypeContainer.style.display = category === "business" ? "block" : "none";
    }

    function getNum(id) { var el = document.getElementById(id); return el ? (parseFloat(el.value)||0) : 0; }
function calculate() {
      const category = document.getElementById("wasteCategory").value;
      const disposalMethod = document.getElementById("disposalMethod").value;
      const wasteType = document.getElementById("wasteType").value;
      const disposalYear = document.getElementById("disposalYear").value;
      const wasteAmount = parseFloat(document.getElementById("wasteAmount").value);

      if (isNaN(wasteAmount) || wasteAmount <= 0) {
        alert("유효한 배출량(kg)을 입력해주세요.");
        return;
      }

      const index = rateIndex[disposalYear];
      let rate = 0;

      if (category === 'business') {
        if (disposalMethod === 'incineration') rate = 10;
        else if (disposalMethod === 'landfill') rate = (wasteType === 'combustible') ? 25 : 10;
      } else if (category === 'construction') {
        rate = (disposalMethod === 'incineration') ? 10 : 30;
      }

      const fee = wasteAmount * rate * index;
      const etsPrice = getNum('etsPrice');
      const recycleValue = (etsPrice>0) ? (carbonReduction/1000) * etsPrice : 0;
      const carbonReduction = Math.round(wasteAmount * EF_MSW_EA_KGKG * 1000) / 1000; // 공식 배출계수 기반 (kgCO₂)
      const unitCost = getNum('unitCostKRW');
      const empCoef = getNum('empCoef');
      const expenditure = (wasteAmount/1000) * unitCost; // 원
      const jobCreation = (expenditure/1_000_000_000) * empCoef;

      document.getElementById("result").innerHTML =
        `<strong>폐기물처분부담금:</strong> ${Math.round(fee).toLocaleString()}원<br>` +
        `<strong>🌍 온실가스 절감:</strong> ${carbonReduction.toLocaleString()}kg CO₂ <span class='text-gray-500'>(IPCC 공식 EF)</span><br>` +
        `<strong>👷 일자리 창출:</strong> ${jobCreation.toFixed(3)} 명 <span class='text-gray-500'>(IO 고용유발계수)</span><br>` +
        `<strong>🌱 환경보전 가치:</strong> ${recycleValue.toLocaleString()}원 <span class='text-gray-500'>(K-ETS 기준가)</span>`;

      const ctx = document.getElementById("costChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["처분부담금", "환경보전 가치"],
          datasets: [{
            label: "비용/편익 (원) — ETS/IO 반영",
            data: [fee, recycleValue],
            backgroundColor: ["#f87171", "#34d399"]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: context => `${context.dataset.label}: ${Math.round(context.raw).toLocaleString()}원`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: value => `${value.toLocaleString()}원`
              }
            }
          }
        }
      });
    }

    let map;
    let marker;
    let infoWindow;

    function initMap() {
      map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(37.5665, 126.9780),
        zoom: 12
      });
    }

    function searchRegion() {
      const keyword = document.getElementById('regionInput').value.trim();
      if (!keyword) {
        alert('지역명을 입력해주세요. 예: 광주 재활용');
        return;
      }

      naver.maps.Service.geocode({ query: keyword }, function(status, response) {
        if (status !== naver.maps.Service.Status.OK || !response.v2.addresses.length) {
          return alert('해당 지역의 주소를 찾을 수 없습니다. 다른 키워드를 입력해주세요.');
        }

        const item = response.v2.addresses[0];
        const position = new naver.maps.LatLng(item.y, item.x);

        map.setCenter(position);

        if (marker) marker.setMap(null);
        marker = new naver.maps.Marker({ map, position });

        if (infoWindow) infoWindow.close();
        infoWindow = new naver.maps.InfoWindow({
          content: `<div style="padding:5px;font-size:14px;">${keyword}</div>`
        });
        infoWindow.open(map, marker);
      });
    }

    window.onload = function () {
      updateOptions();
      initMap();
    };
  </script>
</body>
</html>